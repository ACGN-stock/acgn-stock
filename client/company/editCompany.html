<template name="editCompany">
  {{#with companyData}}
    <div class="card">
      <div class="card-block">
        <h1 class="card-title mb-1">經營管理介面</h1>
        <h2 class="card-subtitle mb-2 text-muted">{{this.companyName}}</h2>
        <hr />
        {{> companyEditForm}}
      </div>
      {{> companyProductManage}}
    </div>
  {{else}}
    Loading...
  {{/with}}
</template>

<template name="companyEditForm">
  <form>
    <div class="form-group">
      <label class="mb-0" for="tags">
        已建立搜索標籤
      </label>
      <div class="col p-0 mb-1">
        {{#each tag in valueOf 'tags'}}
          <span class="badge badge-default d-inline-flex flex-nowrap mw-100">
            <div class="d-inline-block text-truncate">{{tag}}</div>
            <div class="text-nowrap">
              <i
                class="fa fa-times"
                style="cursor: pointer; margin: 0 6px 0 6px"
                data-remove-tag="{{tag}}"
              >
              </i>
            </div>
          </span>
        {{/each}}
      </div>
      <div class="input-group">
        <input
          class="form-control"
          type="text"
          name="tags"
          placeholder="最多50個標籤，每個標籤最多50字"
        />
        <span class="input-group-btn">
          <button class="btn btn-primary" type="button" data-action="addNewTag">
            <i class="fa fa-plus" aria-hidden="true"></i>
            新增搜索標籤
          </button>
        </span>
      </div>
      <small class="form-text text-warning">
        請務必包含：角色名稱、角色名稱原文、登場作品名稱、登場作品名稱原文、角色暱稱、其他方便辨識搜索之名稱。
      </small>
      {{{errorHtmlOf 'tags'}}}
    </div>
    <div class="form-group">
      <label for="pictureSmall">角色小圖</label>
      <div class="input-group">
        <input
          class="form-control"
          type="text"
          name="pictureSmall"
          value="{{valueOf 'pictureSmall'}}"
          placeholder="http://"
        />
        {{#if valueOf 'pictureSmall'}}
          <span class="input-group-btn">
            <button class="btn btn-info" data-preview="pictureSmall" type="button">
              預覽
            </button>
          </span>
          {{#if isPreview 'pictureSmall'}}
            <div
              class="d-block"
              style="position: absolute; top: -100px; right: 0; width: 100px; height: 100px; z-index: 5;">
              <img
                class="w-100 h-100"
                style="object-fit: scale-down;"
                src="{{valueOf 'pictureSmall'}}"
              />
            </div>
          {{/if}}
        {{/if}}
      </div>
      <small class="form-text">大小為100x100。</small>
      {{{errorHtmlOf 'pictureSmall'}}}
    </div>
    <div class="form-group">
      <label for="pictureBig">角色大圖</label>
      <div class="input-group">
        <input
          class="form-control"
          type="text"
          name="pictureBig"
          value="{{valueOf 'pictureBig'}}"
          placeholder="http://"
        />
        {{#if valueOf 'pictureBig'}}
          <span class="input-group-btn">
            <button class="btn btn-info" data-preview="pictureBig" type="button">
              預覽
            </button>
          </span>
          {{> bigPicturePreviewModal src=(valueOf 'pictureBig') }}
        {{/if}}
      </div>
      <small class="form-text">大小為300x300。</small>
      {{{errorHtmlOf 'pictureBig'}}}
    </div>
    <div class="form-group">
      <label for="description">角色介紹</label>
      <textarea
        class="form-control"
        name="description"
        rows="5"
        minlength="10"
        maxlength="3000"
        placeholder="最少10字，最多3000字">{{valueOf 'description'}}
      </textarea>
      <small class="form-text text-warning">必須包括角色名稱以及原作品名稱，其餘內容由經理人自己增修，但不得有任何貶低角色的字眼出現。</small>
      {{{errorHtmlOf 'description'}}}
    </div>
    <div class="text-right">
      <button class="btn btn-primary">送出</button>
      <a class="btn btn-secondary" href="{{getCompanyHref this._id}}">取消</a>
    </div>
  </form>
</template>

<template name="bigPicturePreviewModal">
  <div class="{{modalClass}}" tabindex="-1" role="dialog" style="background-color: rgba(0,0,0,0.4)">
    <div class="modal-dialog" role="document">
      <div class="modal-content border-0 mx-0 my-auto"
        style="background: transparent;">
        <div class="modal-body p-0" style="width: 300px; height: 300px;">
          <img class="w-100 h-100" style="object-fit: scale-down;" src="{{src}}"/>
        </div>
      </div>
    </div>
  </div>
</template>

<template name="companyProductManage">
  <div class="card-block">
    <h3 class="card-title mb-1">產品管理</h3>
    <h5 class="card-subtitle text-muted">
      在這裡準備下個商業季度上架的商品
      <button class="btn btn-primary btn-sm float-right" type="button" data-action="addProduct">
        <i class="fa fa-plus" aria-hidden="true"></i>
        新增
      </button>
    </h5>
    <hr />
    {{#if inAddMode}}
      {{#with defaultProductData}}
        {{> companyProductEditForm}}
      {{/with}}
      <hr />
    {{/if}}
    <table class="table table-sm table-bordered next-season-product">
      <thead>
        <tr>
          <th class="text-center text-truncate" title="產品">產品</th>
          <th class="text-center text-truncate" style="width: 60px;" title="類別">類別</th>
          <th class="text-center text-truncate" style="width: 60px;" title="管理">管理</th>
        </tr>
      </thead>
      <tbody>
        {{#each product in productList}}
          <tr>
            <td class="text-left " data-title="產品">
              <div class="product-name">
                <a href="{{product.url}}" title="{{product.productName}}" target="_blank">
                  {{product.productName}}
                </a>
              </div>
              <div class="small mt-2 product-description">
                {{product.description}}
              </div>
            </td>
            <td class="text-center text-truncate align-middle" data-title="類別">
              {{product.type}}
            </td>
            <td class="text-center text-truncate align-middle" data-title="管理">
              <button class="btn btn-danger btn-sm" type="button" data-retrieve="{{product._id}}">
                <i class="fa fa-trash" aria-hidden="true"></i>
                刪除
              </button>
            </td>
          </tr>
        {{else}}
          <tr class="default-content">
            <td class="text-center text-truncate" colspan="3">目前沒有預定產品！</td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
</template>

<template name="companyProductEditForm">
  <form>
    <div class="small">
      ＊必須
    </div>
    <div class="form-group">
      <label for="productName" data-required>產品名稱</label>
      <input
        class="form-control"
        type="text"
        name="productName"
        value="{{valueOf 'productName'}}"
        minlength="4"
        maxlength="255"
        placeholder="最少4字，最多255字"
      />
      {{{errorHtmlOf 'productName'}}}
    </div>
    <div class="form-group">
      <label for="type" data-required>產品類別</label>
      <select class="form-control" name="type">
        {{#each type in productTypeList}}
          <option value="{{type}}">{{type}}</option>
        {{/each}}
      </select>
      {{{errorHtmlOf 'type'}}}
    </div>
    <div class="form-group">
      <label for="url" data-required>產品連結</label>
      <input
        class="form-control"
        type="url"
        name="url"
        value="{{valueOf 'url'}}"
        placeholder="http://"
      />
      {{{errorHtmlOf 'url'}}}
    </div>
    <div class="form-group">
      <label for="description">產品描述</label>
      <input
        class="form-control"
        type="text"
        name="description"
        value="{{valueOf 'description'}}"
        maxlength="500"
        placeholder="最多500字"
      />
      {{{errorHtmlOf 'description'}}}
    </div>
    <div class="text-right">
      <button class="btn btn-primary" type="submit">送出</button>
      <button class="btn btn-secondary" type="reset">取消</button>
    </div>
  </form>
</template>
