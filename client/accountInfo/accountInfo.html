<template name="accountInfo">
  <div class="card">
    {{#with lookUser}}
      {{> accountInfoBasic}}
      <div class="card-block">
        <div class="row border-grid-body" style="margin-top: 15px;">
          <div class="col-12 border-grid">
            <a class="d-block h4" href="#" data-toggle-panel="tax">
              稅務資訊
              {{#if isDisplayPanel 'tax'}}
                <i class="fa fa-folder-open" aria-hidden="true"></i>
              {{else}}
                <i class="fa fa-folder" aria-hidden="true"></i>
              {{/if}}
            </a>
          </div>
          {{#if isDisplayPanel 'tax'}}
            {{> accountInfoTaxList}}
          {{/if}}
          <div class="col-12 border-grid">
            <a class="d-block h4" href="#" data-toggle-panel="stock">
              持股資訊
              {{#if isDisplayPanel 'stock'}}
                <i class="fa fa-folder-open" aria-hidden="true"></i>
              {{else}}
                <i class="fa fa-folder" aria-hidden="true"></i>
              {{/if}}
            </a>
          </div>
          {{#if isDisplayPanel 'stock'}}
            {{> accountInfoOwnStockList}}
          {{/if}}
          <div class="col-12 border-grid">
            <a class="d-block h4" href="#" data-toggle-panel="log">
              玩家紀錄
              {{#if isDisplayPanel 'log'}}
                <i class="fa fa-folder-open" aria-hidden="true"></i>
              {{else}}
                <i class="fa fa-folder" aria-hidden="true"></i>
              {{/if}}
            </a>
          </div>
          {{#if isDisplayPanel 'log'}}
            {{> accountLogViewer}}
          {{/if}}
        </div>
      </div>
    {{/with}}
  </div>
</template>

<template name="accountInfoBasic">
  <div class="card-block">
    <h1 class="card-title"
        style="
          overflow-x: hidden;
          overflow-y: auto;
          text-overflow: ellipsis;
          min-height: 3.5rem;
          max-height: 8.4rem;
          word-wrap: break-word;">
      使用者「{{this.profile.name}}」帳號資訊
    </h1>
    <hr />
    {{#if currentUser}}
      {{#if currentUser.profile.isAdmin}}
        <button class="btn btn-info btn-sm mt-1" type="button" data-action="fscAnnouncement">金管會通告</button>
        {{#if isBaned 'accuse'}}
          <button class="btn btn-success btn-sm mt-1" type="button" data-ban="accuse">解除舉報禁令</button>
        {{else}}
          <button class="btn btn-warning btn-sm mt-1" type="button" data-ban="accuse">禁止舉報</button>
        {{/if}}
        {{#if isBaned 'deal'}}
          <button class="btn btn-success btn-sm mt-1" type="button" data-ban="deal">解除下單禁令</button>
        {{else}}
          <button class="btn btn-warning btn-sm mt-1" type="button" data-ban="deal">禁止下單</button>
        {{/if}}
        {{#if isBaned 'chat'}}
          <button class="btn btn-success btn-sm mt-1" type="button" data-ban="chat">解除聊天禁令</button>
        {{else}}
          <button class="btn btn-warning btn-sm mt-1" type="button" data-ban="chat">禁止聊天</button>
        {{/if}}
        {{#if isBaned 'advertise'}}
          <button class="btn btn-success btn-sm mt-1" type="button" data-ban="advertise">解除廣告禁令</button>
        {{else}}
          <button class="btn btn-warning btn-sm mt-1" type="button" data-ban="advertise">禁止廣告</button>
        {{/if}}
        <button class="btn btn-warning btn-sm mt-1" type="button" data-action="forfeit">課以罰金</button>
        <button class="btn btn-warning btn-sm mt-1" type="button" data-action="returnForfeit">退還罰金</button>
        {{#if isBaned 'manager'}}
          <button class="btn btn-success btn-sm mt-1" type="button" data-ban="manager">解除禁任經理</button>
        {{else}}
          <button class="btn btn-danger btn-sm mt-1" type="button" data-ban="manager">禁任經理</button>
        {{/if}}
        <button class="btn btn-danger btn-sm mt-1" type="button" data-action="confiscateStocks">沒收股份</button>
      {{else}}
        <button class="btn btn-danger btn-sm mt-1" type="button" data-action="accuse">舉報違規</button>
        {{#if isBaned 'accuse'}}
          <div class="text-danger">目前被禁止舉報違規。</div>
        {{/if}}
        {{#if isBaned 'deal'}}
          <div class="text-danger">目前被禁止投資下單。</div>
        {{/if}}
        {{#if isBaned 'chat'}}
          <div class="text-danger">目前被禁止聊天發言。</div>
        {{/if}}
        {{#if isBaned 'advertise'}}
          <div class="text-danger">目前被禁止廣告宣傳。</div>
        {{/if}}
      {{/if}}
      {{#if showUnregisterEmployee}}
        <button class="btn btn-danger btn-sm mt-1" type="button" data-action="unregisterEmployee">取消員工報名</button>
      {{/if}}

      {{#if isCurrentUser}}
        {{#if this.profile.isInVacation}}
          <button class="btn btn-info btn-sm mt-1" type="button" data-action="toggleEndingVacation">
            {{#if this.profile.isEndingVacation}}
              取消結束渡假
            {{else}}
              結束渡假
            {{/if}}
          </button>
        {{else}}
          <button class="btn btn-info btn-sm mt-1" type="button" data-action="startVacation">開始渡假</button>
        {{/if}}
      {{/if}}
      <hr />
    {{/if}}

    <div>
      帳號驗證方式：
      {{showValidateType}}
    </div>
    <div>
      帳號啟動日期：{{formatDateText this.createdAt}}
    </div>
    <div>
      上次登入時間：{{formatDateText this.status.lastLogin.date}}
    </div>
    <div>
      上次登入IP：{{this.status.lastLogin.ipAddr}}
    </div>
    <div>
      本季度未登入天數：{{this.profile.noLoginDayCount}}
    </div>
    <div>
      上季度財富統計：{{currencyFormat this.profile.lastSeasonTotalWealth}}
    </div>
    <div>
      帳號當前餘額：{{currencyFormat this.profile.money}}
    </div>
    <div>
      帳號剩餘推薦票：{{this.profile.vote}}
    </div>
    <div>
      帳號擁有聖晶石：{{this.profile.stone}}
    </div>
    {{#if this.profile.isInVacation}}
      <div class="text-info">目前正在渡假中。</div>
      {{#if this.profile.isEndingVacation}}
        <div class="text-info">將於本商業季度結束渡假。</div>
      {{/if}}
    {{/if}}
    {{#if this.profile.isAdmin}}
      <div>
        是<div class="d-inline bg-warning text-white">金融管理會委員</div>。
      </div>
    {{/if}}
    {{#if this.profile.revokeQualification}}
      <div class="text-danger">
        被撤銷了擔任經理人的資格！
      </div>
    {{/if}}
    {{> accountCompanyTitle}}
  </div>
</template>

<template name="accountCompanyTitle">
  {{> companyTitleTab}}
  <div class="tab-content">
    <div class="tab-pane active" role="tabpanel">
      {{#if viewType 'chairman'}}
        {{> chairmanTitleList}}
      {{/if}}
      {{#if viewType 'manager'}}
        {{> managerTitleList}}
      {{/if}}
      {{#if viewType 'employee'}}
        {{> employeeTitleList}}
      {{/if}}
    </div>
  </div>
</template>

<template name="companyTitleTab">
  <ul class="nav nav-tabs" role="tablist">
    <li class="nav-item">
      <a class="{{getClass 'chairman'}}" href="" data-type="chairman">董事長</a>
    </li>
    <li class="nav-item">
      <a class="{{getClass 'manager'}}" href="" data-type="manager">經理人</a>
    </li>
    <li class="nav-item">
      <a class="{{getClass 'employee'}}" href="" data-type="employee">員工</a>
    </li>
  </ul>
</template>

<template name="chairmanTitleList">
  {{#each titleList}}
    {{> companyTitle companyId=this._id title='董事長'}}
  {{else}}
    查無資料！
  {{/each}}
  {{#with paginationData}}
    {{> pagination}}
  {{/with}}
</template>

<template name="managerTitleList">
  {{#each titleList}}
    {{> companyTitle companyId=this._id title='經理人'}}
  {{else}}
    查無資料！
  {{/each}}
  {{#with paginationData}}
    {{> pagination}}
  {{/with}}
</template>

<template name="employeeTitleList">
  {{#with employment}}
    {{> companyTitle companyId=this.companyId title='員工'}}
  {{/with}}
  {{#with nextSeasonEmployment}}
    {{> companyTitle companyId=this.companyId title='儲備員工'}}
  {{/with}}
  {{#unless employment}}
    {{#unless nextSeasonEmployment}}
      查無資料！
    {{/unless}}
  {{/unless}}
</template>

<template name="companyTitle">
  <div class="text-primary d-flex flex-nowrap">
    <div class="text-nowrap">是「</div>
    <div class="d-inline-block text-truncate">{{>companyLink companyId}}</div>
    <div class="text-nowrap">」公司的{{title}}。</div>
  </div>
</template>

<template name="accountInfoTaxList">
  <div class="col-12 border-grid">
    <table id="tax-info-table" class="table table-bordered mt-3" style="width: 100%; table-layout: fixed;">
      <thead>
        <tr>
          <th class="text-center text-nowrap" style="width: 160px">繳稅期限</th>
          <th class="text-center text-nowrap">財稅額</th>
          <th class="text-center text-nowrap">殭屍稅</th>
          <th class="text-center text-nowrap ">逾期罰金</th>
          <th class="text-center text-nowrap">已繳納</th>
          {{#if isCurrentUser}}
            <th class="text-center text-nowrap">繳納稅金</th>
          {{/if}}
        </tr>
      </thead>
      <tbody>
        {{#each taxes in taxesList}}
          <tr>
            <td class="text-right text-truncate" data-title="繳稅期限">
              {{formatDateText taxes.expireDate}}
            </td>
            <td class="text-right text-truncate" data-title="財稅額" title="{{taxes.tax}}">
              $ {{currencyFormat taxes.tax}}
            </td>
            <td class="text-right text-truncate" data-title="殭屍稅" title="{{taxes.zombie}}">
              $ {{currencyFormat taxes.zombie}}
            </td>
            <td class="text-right text-truncate" data-title="逾期罰金" title="{{taxes.fine}}">
              $ {{currencyFormat taxes.fine}}
            </td>
            <td class="text-right text-truncate" data-title="已繳納" title="{{taxes.paid}}">
              $ {{currencyFormat taxes.paid}}
            </td>
            {{#if isCurrentUser}}
              <td class="text-center" data-title="繳納稅金">
                <button class="btn btn-success btn-sm" type="button" data-pay="{{taxes._id._str}}">
                  繳納稅金
                </button>
              </td>
            {{/if}}
          </tr>
        {{else}}
          <tr>
            {{#if isCurrentUser}}
              <td class="text-center text-truncate" colspan="6">目前沒有任何需要繳納的稅金！</td>
            {{else}}
              <td class="text-center text-truncate" colspan="5">目前沒有任何需要繳納的稅金！</td>
            {{/if}}
          </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
</template>

<template name="accountInfoOwnStockList">
  <div class="col-12 border-grid">
    <table class="table table-bordered mt-3" style="width: 100%; table-layout: fixed;">
      <thead>
        <tr>
          <th class="text-center text-nowrap">公司名稱</th>
          <th class="text-center text-nowrap" style="width: 95px">持股數</th>
        </tr>
      </thead>
      <tbody>
      {{#each directorData in directorList}}
        <tr>
          <td class="text-left text-truncate p-1" data-title="公司名稱">
            {{>companyLink directorData.companyId}}
          </td>
          <td class="text-right text-truncate p-1" data-title="持股數">
            {{directorData.stocks}} 股
          </td>
        </tr>
      {{else}}
        <tr>
          <td class="text-center text-truncate p-1" colspan="2">查無資料！</td>
        </tr>
      {{/each}}
      </tbody>
    </table>
    {{#with paginationData}}
      {{> pagination}}
    {{/with}}
  </div>
</template>

<template name="accountLogViewer">
  {{#if onlyViewAccuse}}
    {{> accountAccuseLogList}}
  {{else}}
    {{> accountInfoLogList}}
  {{/if}}
</template>

<template name="accountAccuseLogList">
  <div class="col-12 border-grid">
    <button class="btn btn-outline-info btn-sm mt-1">檢視所有紀錄</button>
    {{#each accuseList}}
      {{> displayLog}}
    {{else}}
      查無資料！
    {{/each}}
    {{#with paginationData}}
      {{> pagination}}
    {{/with}}
  </div>
</template>

<template name="accountInfoLogList">
  <div class="col-12 border-grid">
    <button class="btn btn-outline-info btn-sm mt-1">只檢視金管會相關紀錄</button>
    {{#each logList}}
      {{> displayLog}}
    {{else}}
      查無資料！
    {{/each}}
    {{#with paginationData}}
      {{> pagination}}
    {{/with}}
  </div>
</template>
